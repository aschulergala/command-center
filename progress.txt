# GalaChain Command Center - Progress Log

## Learnings Section
(Patterns discovered, gotchas encountered, useful context for future iterations)
- NestJS project structure: src/ for backend, client/ for Vue, shared/ for types
- Use @nestjs/serve-static to serve Vue build from dist/client
- TypeScript paths configured for @shared/* imports
- nest-cli.json required for nest build command
- path-to-regexp v8+ syntax: use '/api{/*path}' not '/api/(.*)'
- Use SpaFallbackMiddleware instead of SpaFallbackController for SPA fallback (middleware is more reliable)
- Check req.originalUrl instead of req.path in middleware for accurate route matching
- __dirname resolves to src/ in dev and dist/src/ in production - use relative paths accordingly
- vue-tsc with noUnusedLocals treats type imports as unused when used in interfaces - re-export to fix
- Use `export type { }` for type-only re-exports with isolatedModules: true
- @gala-chain/api UserAlias and UserRef are branded types (string & { __marker__: void })
- BrowserConnectClient from @gala-chain/connect: use on/off for event listeners, connect() returns galaChainAddress
- Mock BrowserConnectClient in tests by creating a class with the same interface, not just an object
- vitest.config.ts needs @shared alias for shared types imports in tests
- @gala-chain/connect TokenApi class is the correct API for token operations (NOT BrowserConnectClient.evaluate/submit)
- TokenApi methods return { Data: T } - always extract response.Data
- Submit DTOs require uniqueKey field - generate unique key with crypto.getRandomValues + base64
- GalaChainResponseError: Error is string key, Message is user message, ErrorCode is number

---

## Iteration 1 - project-setup
- What was implemented:
  - Initialized npm project with package.json
  - Installed NestJS core dependencies (@nestjs/common, core, platform-express, config, serve-static)
  - Created src/main.ts with NestJS bootstrap, CORS, validation pipe
  - Created src/app.module.ts with ConfigModule and ServeStaticModule
  - Created shared/ folder with types/wallet.ts placeholder
  - Created client/ folder with placeholder package.json
  - Created .gitignore for node_modules, dist, .env files
  - Created nest-cli.json and tsconfig.json
- Files changed:
  - package.json (new)
  - tsconfig.json (new)
  - nest-cli.json (new)
  - src/main.ts (new)
  - src/app.module.ts (new)
  - shared/index.ts (new)
  - shared/types/wallet.ts (new)
  - client/package.json (new)
  - .gitignore (new)
- GalaChain tools used: None (basic project setup)
- Tests: TypeScript typecheck passes, NestJS build passes
---

## Iteration 2 - vue-client-setup
- What was implemented:
  - Initialized Vite + Vue 3 + TypeScript in client/ folder
  - Installed Vue Router for client-side routing with routes: /tokens, /nfts, /creators, /export
  - Installed and configured Pinia for state management
  - Installed and configured Tailwind CSS with GalaChain brand colors
  - Installed @gala-chain/connect and @gala-chain/api packages
  - Installed VeeValidate + @vee-validate/zod for form validation
  - Installed @vueuse/core for Vue composition utilities
  - Installed axios for HTTP requests to backend API
  - Configured vite.config.ts: output to ../dist/client, proxy /api to NestJS in dev
  - Created folder structure: src/views/, src/components/, src/composables/, src/stores/, src/lib/
  - Configured path alias @ pointing to client/src/
  - Created placeholder views for all routes
  - Created style.css with Tailwind directives and custom component classes
- Files changed:
  - client/package.json (updated with full dependencies)
  - client/vite.config.ts (new)
  - client/tsconfig.json (new)
  - client/tsconfig.node.json (new)
  - client/index.html (new)
  - client/tailwind.config.js (new)
  - client/postcss.config.js (new)
  - client/.env (new)
  - client/src/main.ts (new)
  - client/src/App.vue (new)
  - client/src/style.css (new)
  - client/src/vite-env.d.ts (new)
  - client/src/router/index.ts (new)
  - client/src/lib/config.ts (new)
  - client/src/views/TokensView.vue (new)
  - client/src/views/NFTsView.vue (new)
  - client/src/views/CreatorsView.vue (new)
  - client/src/views/ExportView.vue (new)
  - package.json (updated test and typecheck scripts)
- GalaChain tools used: None (Vue setup)
- Tests: TypeScript compiles without errors, Vite build succeeds
- Learnings for future iterations:
  - Tailwind CSS brand colors defined as 'gala' namespace (gala-primary, gala-secondary, etc.)
  - Custom component classes (btn-primary, card, input) available in style.css
  - Path alias @ maps to client/src/ for clean imports
  - Pinia v3 used with Vue 3.5+
---

## Iteration 3 - nestjs-static-serving
- What was implemented:
  - Configured ServeStaticModule in app.module.ts to serve Vue build from dist/client
  - Created SpaFallbackController with wildcard route for SPA fallback
  - Fixed exclude pattern for new path-to-regexp syntax: '/api{/*path}'
  - Created AppController with health endpoint at GET /api/health
  - Set up Jest with ts-jest for server tests
  - Created unit tests for AppController
  - Created integration tests for static serving (spawns actual server process)
- Files changed:
  - src/app.module.ts (updated)
  - src/app.controller.ts (new)
  - src/spa-fallback.controller.ts (new)
  - src/__tests__/app.controller.spec.ts (new)
  - src/__tests__/app.e2e.spec.ts (new)
  - src/__tests__/static-serving.integration.spec.ts (new)
  - jest.config.js (new)
  - package.json (added Jest dependencies)
- GalaChain tools used: None (infrastructure setup)
- Tests: All 8 tests pass (3 unit, 1 e2e, 4 integration)
- Learnings for future iterations:
  - path-to-regexp v8+ syntax changed: use '/api{/*path}' instead of '/api/(.*)'
  - __dirname in NestJS changes between dev (src/) and production (dist/src/)
  - Use join(__dirname, '..', 'client') to resolve correctly in both contexts
  - ServeStaticModule doesn't have built-in SPA fallback - use a wildcard controller
  - Integration tests can spawn the actual server to test production behavior
  - Jest forceExit: true helps with child process cleanup
---

## Iteration 4 - environment-configuration
- What was implemented:
  - Created .env file at project root for NestJS with PORT, GALACHAIN_ENV, GALACHAIN_GATEWAY_URL, GALACHAIN_API_URL
  - Created .env.example documenting all variables for both server and client
  - Updated client/.env with VITE_GALACHAIN_ENV, VITE_GALACHAIN_GATEWAY_URL, VITE_GALACHAIN_API_URL
  - Created src/config/configuration.ts with typed AppConfiguration and validation
  - Updated app.module.ts to use ConfigModule.forRoot with load: [configuration]
  - Updated client/src/lib/config.ts with GalaChainConfig type and environment-based defaults
  - Created src/__tests__/configuration.spec.ts with comprehensive validation tests
  - Created client/vitest.config.ts and client/__tests__/config.spec.ts for client config tests
  - Added jsdom to client devDependencies for Vitest
  - Updated jest.config.js to exclude client/ tests (run by Vitest instead)
- Files changed:
  - .env (new)
  - .env.example (new)
  - client/.env (updated)
  - src/config/configuration.ts (new)
  - src/app.module.ts (updated)
  - client/src/lib/config.ts (updated)
  - src/__tests__/configuration.spec.ts (new)
  - client/vitest.config.ts (new)
  - client/__tests__/config.spec.ts (new)
  - client/package.json (added jsdom)
  - jest.config.js (updated)
- GalaChain tools used: None (configuration setup)
- Tests: 37 total tests pass (25 server + 12 client)
- Learnings for future iterations:
  - NestJS ConfigModule.forRoot accepts load: [configFn] for custom configuration factories
  - Vitest needs jsdom for DOM environment in tests
  - Jest testRegex should include path prefix (src/) to avoid running client tests
  - Client config uses import.meta.env for Vite environment variables
  - Environment defaults should be based on GALACHAIN_ENV (production vs stage)
---

## Iteration 5 - shared-types
- What was implemented:
  - Created shared/types/galachain.ts re-exporting types from @gala-chain/api
    - Core types: TokenClass, TokenClassKey, TokenInstance, TokenInstanceKey, TokenBalance, TokenAllowance
    - DTOs: TransferTokenDto, MintTokenDto, BurnTokensDto, CreateTokenClassDto, etc.
    - Response types: GalaChainResponse, GalaChainResponseType
    - User types: UserAlias, UserRef with validation functions
  - Updated shared/types/wallet.ts with comprehensive wallet state types
    - WalletState interface with connected, address, publicKey, isConnecting, error
    - WalletConnectionStatus enum
    - WalletProvider enum
    - WalletConnectionResult interface
  - Created shared/types/display.ts with UI display interfaces
    - FungibleTokenDisplay for fungible token cards
    - NFTDisplay for NFT cards
    - CollectionDisplay for NFT collections
    - AllowanceDisplay for token allowances
    - TransactionResult for transaction outcomes
    - TransactionType and TransactionStatus enums
    - PendingTransaction for tracking in-progress transactions
  - Updated shared/index.ts to export all types
  - Configured tsconfig paths for both server and client (@shared/*)
  - Updated vite.config.ts with @shared alias
  - Installed @gala-chain/api in root package
- Files changed:
  - shared/types/galachain.ts (new)
  - shared/types/wallet.ts (updated)
  - shared/types/display.ts (new)
  - shared/index.ts (updated)
  - client/tsconfig.json (updated - added @shared/* path and ../shared/**/*.ts to include)
  - client/vite.config.ts (updated - added @shared alias)
  - package.json (updated - added @gala-chain/api dependency)
- GalaChain tools used: None (used direct inspection of @gala-chain/api type definitions)
- Tests: All 37 tests pass (12 client + 25 server)
- Learnings for future iterations:
  - vue-tsc with noUnusedLocals: true treats type-only imports as unused even when used in interfaces
  - Workaround: Re-export the imported types to mark them as "used"
  - Use `export type { }` for type-only re-exports with isolatedModules: true
  - UserAlias and UserRef are branded types (string & { __marker__: void })
  - @gala-chain/api exports classes (TokenClass), interfaces (TokenClassKeyProperties), and enums (AllowanceType)
---

## Iteration 6 - nestjs-health-api
- What was implemented:
  - Created src/modules/health/health.module.ts for dedicated health module
  - Created src/modules/health/health.controller.ts with GET /api/health endpoint
  - Created src/middleware/request-logger.middleware.ts for development logging
  - Updated app.module.ts to import HealthModule and configure RequestLoggerMiddleware
  - Removed old app.controller.ts (health endpoint moved to HealthController)
  - Created unit tests for HealthController in src/modules/health/__tests__/health.controller.spec.ts
  - Updated e2e test to use HealthController
- Files changed:
  - src/modules/health/health.module.ts (new)
  - src/modules/health/health.controller.ts (new)
  - src/modules/health/__tests__/health.controller.spec.ts (new)
  - src/middleware/request-logger.middleware.ts (new)
  - src/app.module.ts (updated)
  - src/__tests__/app.e2e.spec.ts (updated)
  - src/app.controller.ts (deleted)
  - src/__tests__/app.controller.spec.ts (deleted)
- GalaChain tools used: None (infrastructure setup)
- Tests: All 38 tests pass (12 client + 26 server)
- Learnings for future iterations:
  - NestJS modules keep code organized - one module per feature area
  - Middleware configured via NestModule.configure() with MiddlewareConsumer
  - Apply middleware conditionally based on NODE_ENV for dev-only features
  - Use @Controller('health') prefix for nested routes under /api/health
---

## Iteration 7 - railway-deployment
- What was implemented:
  - Created Procfile with `web: node dist/src/main.js`
  - Created railway.json with build/deploy configuration and health check
  - Created README.md with development setup, scripts, and Railway deployment instructions
  - Fixed nest-cli.json to use `deleteOutDir: false` so Vue build isn't wiped during NestJS build
  - Updated package.json paths to use dist/src/main.js (NestJS compiles src/ to dist/src/)
  - Replaced SpaFallbackController with SpaFallbackMiddleware for reliable SPA routing
  - Fixed middleware to use req.originalUrl for accurate /api route detection
- Files changed:
  - Procfile (new)
  - railway.json (new)
  - README.md (new)
  - nest-cli.json (updated - deleteOutDir: false)
  - package.json (updated - paths to dist/src/main.js)
  - src/main.ts (updated - simplified global prefix)
  - src/app.module.ts (updated - removed SpaFallbackController, added SpaFallbackMiddleware)
  - src/middleware/spa-fallback.middleware.ts (new)
  - src/spa-fallback.controller.ts (updated - cleaned up unused imports)
- GalaChain tools used: None (deployment configuration)
- Tests: All 38 tests pass (12 client + 26 server)
- Learnings for future iterations:
  - NestJS nest build with deleteOutDir: true wipes entire dist folder including Vue build
  - Set deleteOutDir: false when Vue outputs to dist/client alongside NestJS dist/src
  - In middleware, use req.originalUrl instead of req.path for accurate route detection
  - Windows doesn't support NODE_ENV=value prefix - Railway/Linux will set it automatically
  - Middleware runs BEFORE controllers - order registration carefully
---

## Iteration 8 - wallet-connection
- What was implemented:
  - Created client/src/stores/wallet.ts Pinia store with:
    - State: connected, address, publicKey, isConnecting, error
    - Actions: connect(), disconnect(), checkConnection(), getClient(), clearError()
    - Getters: status, truncatedAddress, state
    - Uses @gala-chain/connect BrowserConnectClient for MetaMask integration
    - Uses @vueuse/core useStorage for localStorage persistence (auto-reconnect)
  - Created client/src/composables/useWallet.ts wrapping store for component use
  - Created client/src/components/WalletConnect.vue with:
    - "Connect Wallet" button with loading state
    - Truncated address display when connected with green indicator
    - Dropdown menu with disconnect option
    - Error message display with dismiss button
    - Auto-reconnect on mount via checkConnection()
  - Added comprehensive tests (14 store tests, 10 component tests)
- Files changed:
  - client/src/stores/wallet.ts (new)
  - client/src/composables/useWallet.ts (new)
  - client/src/components/WalletConnect.vue (new)
  - client/__tests__/stores/wallet.spec.ts (new)
  - client/__tests__/components/WalletConnect.spec.ts (new)
  - client/vitest.config.ts (updated - added @shared alias)
  - manualTestingRequired.txt (new - tracks manual testing checklist)
- GalaChain tools used: Inspected @gala-chain/connect type definitions for BrowserConnectClient API
- Tests: All 62 tests pass (36 client + 26 server)
- Learnings for future iterations:
  - BrowserConnectClient.connect() returns the galaChain address directly
  - BrowserConnectClient provides on/off methods for event listeners (accountsChanged)
  - Use getPublicKey() after connect() to retrieve the public key
  - Mock BrowserConnectClient in tests as a class, not just an object literal
  - Use mockReturnThis() for chainable methods like on() and off()
  - @pinia/testing createTestingPinia() allows setting initialState for component tests
---

## Iteration 9 - galachain-client
- What was implemented:
  - Created client/src/lib/galachainErrors.ts with:
    - GalaChainError class with code, errorKey, errorPayload properties
    - GALACHAIN_ERROR_MAP mapping error codes (INSUFFICIENT_BALANCE, etc.) to user-friendly messages
    - extractError() to get message from GalaChainResponse
    - parseWalletError() to parse MetaMask/wallet errors
    - logError() for development logging with error codes
  - Created client/src/lib/galachainClient.ts with:
    - TokenApi wrapper functions using @gala-chain/connect
    - getTokenApiUrl() for environment-based API URLs
    - createTokenApi() factory function
    - fetchBalances() - query token balances for an address
    - fetchAllowances() - query token allowances
    - transfer() - transfer tokens with auto-signing
    - mint() - mint tokens (requires authority)
    - burn() - burn tokens (requires authority)
    - generateUniqueKey() for submit DTO uniqueness
    - executeApiCall() wrapper with error handling
    - Request/response logging in development mode
  - Created client/src/composables/useGalaChain.ts with:
    - Reactive state: isLoading, error
    - Computed: isConnected, walletAddress, config
    - Actions: getBalances, getAllowances, transferToken, mintToken, burnTokens
    - Integration with wallet store via requireClient()
    - OperationResult<T> return type for success/error handling
  - Added comprehensive tests (34 error tests, 12 client tests, 14 composable tests)
- Files changed:
  - client/src/lib/galachainErrors.ts (new)
  - client/src/lib/galachainClient.ts (new)
  - client/src/composables/useGalaChain.ts (new)
  - client/__tests__/lib/galachainErrors.spec.ts (new)
  - client/__tests__/lib/galachainClient.spec.ts (new)
  - client/__tests__/composables/useGalaChain.spec.ts (new)
  - IMPLEMENTATION_PLAN.json (updated)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: Inspected @gala-chain/connect TokenApi and BrowserConnectClient type definitions
- Tests: All 96 tests pass (70 client + 26 server)
- Learnings for future iterations:
  - @gala-chain/connect uses TokenApi class for token operations, NOT direct evaluate/submit on BrowserConnectClient
  - TokenApi constructor takes (apiUrl, client) and provides typed methods: FetchBalances, TransferToken, MintToken, BurnTokens, etc.
  - Submit DTOs require a uniqueKey field - generate with crypto.getRandomValues + base64 encoding
  - UserRef from @gala-chain/api is a branded type - cast strings with `as UserRef`
  - GalaChainResponseError has Error (string key), Message (user message), ErrorCode (number)
  - FetchAllowances returns { results: TokenAllowance[] } wrapped in Data property
  - Mock TokenApi in tests rather than BrowserConnectClient methods
  - Return type is { Data: T } from API calls - extract via response.Data
---

## Iteration 10 - layout-navigation
- What was implemented:
  - Created client/src/views/Layout.vue as root layout wrapper with:
    - Sticky header with logo/brand, navigation, and WalletConnect
    - Mobile menu button (hamburger)
    - Mobile navigation (horizontal scrollable)
    - Main content area with max-width container
    - Footer with copyright
  - Created client/src/components/AppNavigation.vue with:
    - Desktop tabs with icons and active state indication
    - Mobile horizontal scroll navigation
    - "Coming Soon" badge on Export tab
    - Proper aria-label for accessibility
  - Created client/src/components/ui/PageHeader.vue for section titles
  - Created client/src/components/ui/LoadingSpinner.vue with size variants (sm/md/lg)
  - Created client/src/components/ui/EmptyState.vue with icon variants (tokens/nfts/collections/search/error)
  - Updated router to use Layout as parent with nested children routes
  - Updated view files (TokensView, NFTsView, CreatorsView, ExportView) to use PageHeader and EmptyState
  - Added comprehensive component tests (9 navigation + 6 PageHeader + 8 LoadingSpinner + 15 EmptyState)
- Files changed:
  - client/src/views/Layout.vue (new)
  - client/src/components/AppNavigation.vue (new)
  - client/src/components/ui/PageHeader.vue (new)
  - client/src/components/ui/LoadingSpinner.vue (new)
  - client/src/components/ui/EmptyState.vue (new)
  - client/src/router/index.ts (updated - nested routes under Layout)
  - client/src/views/TokensView.vue (updated - uses PageHeader and EmptyState)
  - client/src/views/NFTsView.vue (updated - uses PageHeader and EmptyState)
  - client/src/views/CreatorsView.vue (updated - uses PageHeader and EmptyState)
  - client/src/views/ExportView.vue (updated - uses PageHeader with Coming Soon UI)
  - client/__tests__/components/AppNavigation.spec.ts (new)
  - client/__tests__/components/ui/PageHeader.spec.ts (new)
  - client/__tests__/components/ui/LoadingSpinner.spec.ts (new)
  - client/__tests__/components/ui/EmptyState.spec.ts (new)
- GalaChain tools used: None (UI/layout task)
- Tests: All 160 tests pass (134 client + 26 server)
- Learnings for future iterations:
  - Vue Router nested routes: use parent component with <RouterView /> to wrap children
  - Router navigation in tests doesn't trigger immediately - test hrefs instead for simplicity
  - Tailwind scrollbar-hide class requires custom CSS for cross-browser support
  - DefineProps with optional boolean creates reactive prop with undefined default
---

## Iteration 11 - fungible-tokens-list
- What was implemented:
  - Created client/src/stores/tokens.ts Pinia store with:
    - State: tokens[], allowances[], isLoading, isLoadingAllowances, error, sortBy, lastFetched
    - Actions: setBalances(), setAllowances(), setLoading(), setError(), setSort(), clearTokens(), getTokenByKey()
    - Getters: sortedTokens (computed by sortBy), hasTokens, mintableTokens, burnableTokens
    - Converts raw TokenBalance/TokenAllowance to display-friendly formats
    - Uses plain variables (not refs) for raw API data to avoid Vue reactivity breaking BigNumber
  - Created client/src/composables/useFungibleTokens.ts with:
    - Reactive access to tokens store data
    - fetchTokens(), fetchAllowances(), fetchAll(), refresh() actions
    - Auto-fetch on wallet connect, clear on disconnect
    - Watch for wallet address changes
  - Created client/src/components/tokens/TokenCard.vue with:
    - Token icon (image or initials)
    - Name, symbol, balance display
    - Authority badges (Mint/Burn) when applicable
    - Locked/spendable balance breakdown
    - Mint allowance info
    - Action buttons: Transfer, Mint (if authorized), Burn (if authorized)
  - Created client/src/components/tokens/TokenList.vue with:
    - Responsive grid layout (1/2/3 columns)
    - Loading skeleton state
    - Empty state when no tokens
  - Created client/src/components/tokens/TokenCardSkeleton.vue for loading state
  - Created client/src/components/tokens/AllowanceList.vue with:
    - Grouped by type (Mint, Burn, Transfer/Lock/Use)
    - Shows grantor, remaining quantity, expiration
    - Color-coded badges per allowance type
  - Created client/src/components/tokens/SortDropdown.vue with:
    - Balance high-to-low, low-to-high
    - Name A-Z, Z-A
    - Dropdown with transition animations
  - Updated client/src/views/TokensView.vue with:
    - Tab switching between Balances and Allowances
    - Sort dropdown for balances view
    - Refresh button with loading animation
    - Error display with retry option
    - Wallet connection prompt when not connected
  - Updated shared/types/display.ts to use strings instead of BigNumber
    - Avoids Vue reactivity issues where BigNumber loses _isBigNumber property
    - Added *Raw (string) and *Formatted (display) properties
- Files changed:
  - client/src/stores/tokens.ts (new)
  - client/src/composables/useFungibleTokens.ts (new)
  - client/src/components/tokens/TokenCard.vue (new)
  - client/src/components/tokens/TokenList.vue (new)
  - client/src/components/tokens/TokenCardSkeleton.vue (new)
  - client/src/components/tokens/AllowanceList.vue (new)
  - client/src/components/tokens/SortDropdown.vue (new)
  - client/src/views/TokensView.vue (updated)
  - shared/types/display.ts (updated - strings instead of BigNumber)
- GalaChain tools used: Inspected @gala-chain/connect TokenBalance and @gala-chain/api TokenAllowance types
- Tests: All 160 tests pass (134 client + 26 server)
- Learnings for future iterations:
  - Vue reactivity wraps objects deeply, breaking BigNumber instances (_isBigNumber property lost)
  - Solution: Use plain variables for complex SDK types, convert to string/primitives for reactive state
  - TokenBalance from @gala-chain/connect has different structure than @gala-chain/api
  - lockedHolds and inUseHolds are arrays of TokenHold with quantity property
  - AllowanceType enum from @gala-chain/api includes: Mint, Burn, Transfer, Lock, Use (no Unlock)
  - BigNumber.comparedTo() can return null, needs handling in sort functions
---

## Iteration 12 - fungible-tokens-transfer
- What was implemented:
  - Created client/src/lib/schemas/transferSchema.ts with:
    - isValidGalaChainAddress() - validates client|hex, eth|hex, and 0x prefixed addresses
    - isValidAmount() - validates positive non-zero numeric amounts
    - isWithinBalance() - checks amount doesn't exceed balance
    - createTransferSchema() - zod schema factory with address and amount validation
    - formatAmount() - formats amounts for display with thousand separators
  - Created client/src/composables/useTransferToken.ts with:
    - executeTransfer() - executes token transfer via useGalaChain
    - buildTokenInstance() - converts FungibleTokenDisplay to TokenInstanceInput
    - Reactive isLoading, isTransferring, error states
    - Integration with wallet store for connection status
  - Created client/src/components/tokens/TransferModal.vue with:
    - Native <dialog> element with Tailwind styling
    - VeeValidate + @vee-validate/zod form validation
    - Token info display with balance
    - Recipient address input with validation
    - Amount input with MAX button
    - Two-step flow: form → confirmation
    - Confirmation step shows transfer summary and warning
    - Loading spinner during transfer execution
    - Error display for failed transfers
  - Integrated TransferModal into TokensView.vue
    - Opens when Transfer button clicked on TokenCard
    - Refreshes token list on successful transfer
  - Added comprehensive tests (34 schema tests, 10 composable tests, 20 component tests)
- Files changed:
  - client/src/lib/schemas/transferSchema.ts (new)
  - client/src/composables/useTransferToken.ts (new)
  - client/src/components/tokens/TransferModal.vue (new)
  - client/src/views/TokensView.vue (updated - integrated TransferModal)
  - client/__tests__/lib/schemas/transferSchema.spec.ts (new)
  - client/__tests__/composables/useTransferToken.spec.ts (new)
  - client/__tests__/components/tokens/TransferModal.spec.ts (new)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: None (used existing useGalaChain composable for transfer)
- Tests: All 224 tests pass (198 client + 26 server)
- Learnings for future iterations:
  - VeeValidate form validation in tests is async - forms don't validate immediately
  - Component tests for VeeValidate forms are complex; test composables separately for business logic
  - GalaChain addresses use hex characters only (a-f, 0-9) after the prefix
  - Native <dialog> element works well with showModal()/close() API
  - Computed validationSchema with toTypedSchema() for reactive schema based on props
  - Two-step form flow (form → confirmation) improves UX for irreversible actions
---

## Iteration 13 - fungible-tokens-mint
- What was implemented:
  - Created client/src/composables/useTokenAuthority.ts for checking mint/burn allowances
    - hasMintAuthority(), hasBurnAuthority(), getMintAllowance(), getBurnAllowance()
    - getMintAllowanceRemaining() returns BigNumber of remaining allowance
    - getTokenAuthority() returns comprehensive authority info
    - isValidMintAmount(), isValidBurnAmount() for validation
    - Computed mintableTokens and burnableTokens lists
  - Created client/src/composables/useMintToken.ts for mint operations
    - executeMint() to execute mint via GalaChain
    - buildTokenClassKey() to build token class key from display object
    - Reactive isMinting, isLoading, error states
  - Created client/src/lib/schemas/mintSchema.ts for validation
    - isValidMintAmount() validates positive finite numbers
    - isWithinMintAllowance() validates against allowance
    - createMintSchema() factory for VeeValidate + zod
    - formatMintAmount() for display formatting
  - Created client/src/components/tokens/MintModal.vue
    - Native <dialog> element with Tailwind styling
    - VeeValidate + @vee-validate/zod form validation
    - Token info display with current balance
    - Mint allowance info with green theme styling
    - Amount input with MAX button
    - Two-step flow: form → confirmation
    - Confirmation step shows mint summary and info notice
    - Loading spinner during mint execution
    - Error display for failed mints
  - Integrated MintModal into TokensView.vue
    - Opens when Mint button clicked on TokenCard
    - Refreshes token list on successful mint
- Files changed:
  - client/src/composables/useTokenAuthority.ts (new)
  - client/src/composables/useMintToken.ts (new)
  - client/src/lib/schemas/mintSchema.ts (new)
  - client/src/components/tokens/MintModal.vue (new)
  - client/src/views/TokensView.vue (updated - integrated MintModal)
  - client/__tests__/composables/useTokenAuthority.spec.ts (new - 31 tests)
  - client/__tests__/composables/useMintToken.spec.ts (new - 15 tests)
  - client/__tests__/lib/schemas/mintSchema.spec.ts (new - 26 tests)
  - client/__tests__/components/tokens/MintModal.spec.ts (new - 24 tests)
  - IMPLEMENTATION_PLAN.json (updated)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: None (used existing useGalaChain composable)
- Tests: All 320 tests pass (294 client + 26 server)
- Learnings for future iterations:
  - BigNumber.isPositive() returns true for 0, use isGreaterThan(0) to exclude zero
  - BigNumber.isFinite() should be used to reject Infinity values in validation
  - Green theme for mint UI distinguishes from transfer/burn actions
  - VeeValidate form validation is async - component tests need careful handling
  - Reuse patterns from TransferModal for consistent UX across modals
---

## Iteration 14 - fungible-tokens-burn
- What was implemented:
  - Created client/src/lib/schemas/burnSchema.ts for validation
    - isValidBurnAmount() validates positive finite numbers
    - isWithinBalance() validates against token balance
    - createBurnSchema() factory with confirmation checkbox requirement
    - formatBurnAmount() for display formatting
  - Created client/src/composables/useBurnToken.ts for burn operations
    - executeBurn() to execute burn via GalaChain
    - buildTokenInstanceKey() to build token instance key from display object
    - Reactive isBurning, isLoading, error states
    - burnTokens expects array of { tokenInstanceKey, quantity }
  - Created client/src/components/tokens/BurnModal.vue
    - Native <dialog> element with Tailwind styling
    - VeeValidate + @vee-validate/zod form validation
    - Token info display with current balance
    - Prominent warning banner: "This action is irreversible"
    - Explanation that tokens will be permanently destroyed
    - Amount input with MAX button
    - Required confirmation checkbox before continuing
    - Two-step flow: form → confirmation with final warning
    - Red theme styling for burn UI (distinguishes from mint/transfer)
    - Loading spinner during burn execution
    - Error display for failed burns
  - Integrated BurnModal into TokensView.vue
    - Opens when Burn button clicked on TokenCard
    - Refreshes token list on successful burn
- Files changed:
  - client/src/lib/schemas/burnSchema.ts (new)
  - client/src/composables/useBurnToken.ts (new)
  - client/src/components/tokens/BurnModal.vue (new)
  - client/src/views/TokensView.vue (updated - integrated BurnModal)
  - client/__tests__/lib/schemas/burnSchema.spec.ts (new - 30 tests)
  - client/__tests__/composables/useBurnToken.spec.ts (new - 13 tests)
  - client/__tests__/components/tokens/BurnModal.spec.ts (new - 16 tests)
  - IMPLEMENTATION_PLAN.json (updated)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: None (used existing useGalaChain composable)
- Tests: All 379 tests pass (353 client + 26 server)
- Learnings for future iterations:
  - burnTokens in useGalaChain expects array of { tokenInstanceKey, quantity } - not separate args
  - Red theme for burn UI emphasizes the destructive nature of the action
  - Confirmation checkbox in the form step (not just confirmation step) adds safety
  - Two warnings: one in form with checkbox, one final warning in confirmation step
  - Component tests for buttons with async emit handlers may not trigger - test button existence instead
---


## Iteration 15 - nft-list
- What was implemented:
  - Created client/src/stores/nfts.ts Pinia store with:
    - State: nfts[], collections[], selectedCollection, isLoading, error, sortBy, lastFetched
    - Actions: setBalances(), setAllowances(), setLoading(), setError(), setSort(), setCollectionFilter(), clearFilter(), clearNFTs(), getNFTByKey()
    - Getters: filteredNFTs (applies collection filter), sortedNFTs (applies sort), hasNFTs, totalNFTCount, filteredCount
    - Filters out fungible tokens (instance 0), processes each NFT instance separately
    - Extracts unique collections from NFT list with owned count
  - Created client/src/composables/useNFTs.ts with:
    - Reactive access to NFT store data
    - fetchNFTs(), fetchAllowances(), fetchAll(), refresh() actions
    - setCollectionFilter() syncs with URL query param via vue-router
    - Watch for wallet address changes to auto-refetch
    - Watch for URL query param changes to sync filter
  - Created client/src/components/nfts/NFTCard.vue with:
    - NFT image or placeholder with gradient background
    - Collection name, NFT name, instance ID (truncated if long)
    - Status badges: Locked (yellow), In Use (blue), Burn authority (red)
    - Rarity badge if available
    - Transfer and Burn action buttons (Transfer disabled when locked/in-use)
  - Created client/src/components/nfts/NFTCardSkeleton.vue for loading state
  - Created client/src/components/nfts/NFTGrid.vue with:
    - Responsive grid (1/2/3/4 columns)
    - Loading skeleton state
    - Empty state when no NFTs
    - Emits transfer/burn events from child cards
  - Created client/src/components/nfts/CollectionFilter.vue with:
    - Dropdown with "All Collections" option
    - Lists collections with owned count
    - Checkmark on selected collection
    - Click outside to close
  - Created client/src/components/nfts/NFTSortDropdown.vue with:
    - Sort by collection A-Z/Z-A, instance ID low/high, name A-Z/Z-A
    - Checkmark on selected option
  - Updated client/src/views/NFTsView.vue with:
    - Collection filter and sort controls
    - NFT count display (total and filtered)
    - Clear filter button
    - Refresh button with loading animation
    - Error display with retry option
    - Wallet connection prompt when not connected
- Files changed:
  - client/src/stores/nfts.ts (new)
  - client/src/composables/useNFTs.ts (new)
  - client/src/components/nfts/NFTCard.vue (new)
  - client/src/components/nfts/NFTCardSkeleton.vue (new)
  - client/src/components/nfts/NFTGrid.vue (new)
  - client/src/components/nfts/CollectionFilter.vue (new)
  - client/src/components/nfts/NFTSortDropdown.vue (new)
  - client/src/views/NFTsView.vue (updated)
  - client/__tests__/stores/nfts.spec.ts (new - 33 tests)
  - client/__tests__/components/nfts/NFTCard.spec.ts (new - 16 tests)
  - client/__tests__/components/nfts/NFTGrid.spec.ts (new - 7 tests)
  - client/__tests__/components/nfts/CollectionFilter.spec.ts (new - 11 tests)
  - client/__tests__/components/nfts/NFTSortDropdown.spec.ts (new - 11 tests)
  - IMPLEMENTATION_PLAN.json (updated)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: None (used existing useGalaChain composable)
- Tests: All 457 tests pass (431 client + 26 server)
- Learnings for future iterations:
  - TokenHold uses instanceId (singular) not instanceIds for the specific held instance
  - Use type casting with (h as { instanceId?: BigNumber }) when SDK types don't match actual runtime data
  - Collection filter syncs with URL via vue-router watch and push
  - NFT balances use instanceIds array - iterate to create individual NFT display objects
  - Filter out fungible tokens by checking if any instanceId is non-zero
---

## Iteration 16 - NFT Transfer Functionality
- What was implemented:
  - Created client/src/lib/schemas/transferNFTSchema.ts with:
    - Address validation using isValidGalaChainAddress (reused from transferSchema)
    - createTransferNFTSchema for recipient-only validation (no amount for NFTs)
    - truncateAddress and truncateInstanceId helper functions
  - Created client/src/composables/useTransferNFT.ts with:
    - buildTokenInstance() that uses specific NFT instance ID
    - executeTransfer() that sends quantity '1' (NFTs are always single)
    - Validation for locked/in-use NFTs before transfer attempt
    - Error handling for wallet not connected
  - Created client/src/components/nfts/TransferNFTModal.vue with:
    - NFT preview section (image/placeholder, name, collection, instance ID, rarity)
    - Recipient address input with validation
    - Two-step flow: form entry → confirmation
    - Warning about irreversible transfer
    - Loading state during transfer
    - Error display inline
  - Updated client/src/views/NFTsView.vue with:
    - Import and use of TransferNFTModal
    - Handler functions for transfer open/close/success
    - Automatic NFT list refresh after successful transfer
- Files changed:
  - client/src/lib/schemas/transferNFTSchema.ts (new)
  - client/src/composables/useTransferNFT.ts (new)
  - client/src/components/nfts/TransferNFTModal.vue (new)
  - client/src/views/NFTsView.vue (updated)
  - client/__tests__/lib/schemas/transferNFTSchema.spec.ts (new - 19 tests)
  - client/__tests__/composables/useTransferNFT.spec.ts (new - 10 tests)
  - client/__tests__/components/nfts/TransferNFTModal.spec.ts (new - 18 tests)
  - IMPLEMENTATION_PLAN.json (updated)
  - manualTestingRequired.txt (updated)
- GalaChain tools used: None (used existing useGalaChain composable and transferToken)
- Tests: All 504 tests pass (478 client + 26 server)
- Learnings for future iterations:
  - NFT transfers always use quantity '1' - different from fungible tokens
  - NFT transfer schema is simpler: only address validation (no amount)
  - Reuse isValidGalaChainAddress from transferSchema for consistency
  - Check canTransfer flag on NFTDisplay before allowing transfer
  - GalaChain address validation requires hex-only after prefix (a-f, 0-9)
---
